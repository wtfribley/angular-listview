!function(e){"use strict";var t=e.$$minErr("listview");e.module("listview",[]).factory("listViewParser",["$parse",function(e){var i=/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/,n=/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/;return{parse:function(s){var r=s.match(i);if(!r)throw new t("iexp","Expected expression in form of '_item_ in _collection_ (track by _id_)?' but got '{0}'.",s);var o=r[2],l=r[1];if(r=l.match(n),!r)throw new t("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",l);return{collectionMapper:e(o),keyIdentifier:r[2]||"$index"}}}}]).controller("ListViewCtrl",["$animate",function(e){this.selectMode="none",this.selectElements=[],this.parserResult=null,this.editModeHandlers=[],this.inEditMode=!1,this.select=function(t){var i=this.selectMode;if("none"!=i){if("single"==i||"active"==i)for(var n=0,s=this.selectElements.length;s>n;n++)e.removeClass(this.selectElements[n],"selected");e.addClass(t,"selected"),"active"==i&&e.addClass(t,"active")}},this.deselect=function(t){t.hasClass("active")&&e.removeClass(t,"active"),e.removeClass(t,"selected")},this.registerSelectElement=function(e){var t=this.selectElements;return t.push(e),function(){t.splice(t.indexOf(e),1)}},this.toggleEditMode=function(){this.inEditMode=!this.inEditMode;for(var e=0,t=this.editModeHandlers.length;t>e;e++)this.editModeHandlers[e](this.inEditMode);return this.inEditMode},this.registerEditModeHandler=function(e){var t=this.editModeHandlers;return t.push(e),function(){t.splice(t.indexOf(e),1)}},this.remove=function(e){var t=this.parserResult;return function(){var i,n=t.collectionMapper(e),s=e.$eval(t.keyIdentifier);Array.isArray(n)?i=n.splice(s,1)[0]:(i=n[s],delete n[s]),e.$emit("listview.remove",i,n)}}}]).directive("listView",["listViewParser",function(e){function t(e){return e.tagName&&(e.hasAttribute("list-item")||e.hasAttribute("data-list-item")||"list-item"===e.tagName.toLowerCase()||"data-list-item"===e.tagName.toLowerCase())}var i={single:"single",multi:"multi",active:"active",none:"none"};return{restrict:"EA",controller:"ListViewCtrl",compile:function(n,s){for(var r,o=n.contents(),l=0,c=o.length;c>l;l++)if(t(o[l])){r=o.eq(l);break}return r.attr("ng-repeat",s.list),function(t,n,s,r){r.selectMode=i[s.selectMode]||"none",r.parserResult=e.parse(s.list)}}}}]).directive("listEdit",["$parse","$q",function(e,t){return{restrict:"A",require:"^listView",link:function(i,n,s,r){var o=s.editOn||"click",l=s.listEdit?e(s.listEdit):function(){return!0};n.on(o,function(e){return e.stopPropagation(),r.inEditMode?r.toggleEditMode():void t.when(l(i,{$event:e})).then(function(e){e!==!1&&r.toggleEditMode()})})}}}]).directive("listAdd",function(){return{restrict:"A",require:"^listView",link:function(){}}}).directive("listItem",["$parse","$q","$timeout",function(e,t,i){return{restrict:"EA",require:"^listView",link:function(n,s,r,o){var l="none"==o.selectMode?null:r.selectOn||"click";if(l){var c=function(){return!0},a=null;n.$selected=!1,"active"==o.selectMode&&(n.$active=!1);var d=o.registerSelectElement(s);n.$on("$destroy",d),r.selectFn&&(c=e(r.selectFn)),s.on(l,function(e){if(e.stopPropagation(),"click"==l){var r=!a;i.cancel(a),a=i(function(){a=null},300)}else r=!0;if(r){if(s.hasClass("selected"))return o.deselect(s);t.when(c(n,{$event:e})).then(function(e){e!==!1&&o.select(s)})}})}}}}]).directive("listItemEdit",["$animate","$parse",function(t,i){return{restrict:"A",require:"^listView",link:function(n,s,r,o){var l=function(e){t[e?"removeClass":"addClass"](s,"ng-hide")},c=o.registerEditModeHandler(l);n.$on("$destroy",c),l(!1);var a=r.editOn||"click",d=r.listItemEdit||e.noop;"delete"==d||"remove"==d?d=o.remove(n):"string"==typeof d&&(d=i(d)),s.on(a,function(e){e.stopPropagation(),n.$apply(function(){d(n,{$event:e})})})}}}])}(angular);